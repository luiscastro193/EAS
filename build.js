function e(e){return new Promise((e=>setTimeout(e,1500)))}window.request=async function(e,t){let n=await fetch(e,t);if(n.ok)return n;throw n},window.htmlToElement=function(e){let t=document.createElement("template");return t.innerHTML=e.trim(),t.content.firstChild},window.AuxEvent=class{constructor(){this.event=document.createElement("e"),this.aux=new Event("e")}addListener(e,t){let n=this.event;n.addEventListener("e",(function a(){document.contains(e)?t():n.removeEventListener("e",a)}))}dispatch(){this.event.dispatchEvent(this.aux)}},window.Observable=class{constructor(e){this.variable=e,this.event=new AuxEvent}get value(){return this.variable}set value(e){this.variable=e,this.event.dispatch()}subscribe(e,t){this.event.addListener(e,t)}},window.dataPromise=async function(){let t;for(;!t;)t=await request("data.json").then((e=>e.json())).catch(e);return t}(),window.htmlData={title:document.querySelector("h1").innerText,header:document.querySelector("header").innerHTML,main:document.querySelector("main").innerHTML};let t=new Promise((e=>{document.head.querySelector("[data-id=vegaEmbed]").onload=()=>e()})),n=[];function a(){let e=location.pathname;return e.endsWith("/")?e:e+"/"}const l=dataPromise.then((e=>Object.keys(e.ediciones)));function i(e){let t=e.split(";")[0].split("/");return t[t.length-1]}function o(e){if(document.body.contains(e[0]))return!0;e[1]()}function r(){alert("Copia el enlace de esta página para guardar la selección")}async function s(){let e=htmlToElement(`<header class="main-header-container">\n\t\t<a class="home-link" href="#"><i class="fa-solid fa-house"></i></a>\n\t\t<header class="main-header">\n\t\t\t<label for="main-info-checkbox"><h1>${htmlData.title} <span><i class="fa-solid fa-circle-info"></i></span></h1></label>\n\t\t\t<input id="main-info-checkbox" type="checkbox">\n\t\t\t<p class="main-info">${(await dataPromise).infoResultados}</p>\n\t\t</header>\n\t\t<section class="downloads">\n\t\t\t<span><i class="fa-solid fa-download"></i></span>\n\t\t\t<a role="link">Enlace</a>\n\t\t</section>\n\t</header>`);return e.querySelector(".downloads > a").onclick=share,e}function c(e){return e.estimadores}function d(e){let t=new URLSearchParams(location.hash.substring(1)),n={};for(let[e,a]of t)n[e]=a.split(" ");return function(e,t){let n=c(t);return!!(e.var&&e.est&&e.seg&&e.m&&e.var.length&&e.est.length&&e.seg.length&&e.m.length&&e.var.every((e=>t.variables[e]))&&e.est.every((e=>n[e]))&&e.seg.every((e=>t.segmentaciones[e]))&&e.m.every((e=>t.ediciones[e])))}(n,e)&&n}function h(e,t,n){let a=e.split(";")[1].split(","),l=n.filter((e=>!t.includes(e)));return a.some((e=>!l.some((t=>e.includes(t)))))}async function u(){let e=location.hash,t=htmlToElement('<main class="results-page"></main>'),n=await dataPromise;if(e!=location.hash)return t;let a=d(n);if(!a)return location.hash="",t;let l=function(e,t){let n=Object.keys(t.ediciones),a=new Map;for(let l of e.var){let i=t.variables[l].archivos,o=new Map;for(let t of e.est){let a=i[t];if(!a)continue;let l=new Map;for(let t of e.seg){let i=a[t];i&&(i=i.filter((t=>h(t,e.m,n))),i.length&&l.set(t,i))}l.size&&o.set(t,l)}o.size&&a.set(l,o)}return a}(a,n);if(!l.size)return t.append(htmlToElement("<p>Ningún estimador seleccionado está disponible para las variables y ediciones seleccionadas.</p>")),t;let i,o=c(n),r=0;if(a.seg.length>1?r=3:a.est.length>1?r=2:a.var.length>1&&(r=1),r>=1){i=htmlToElement('<h2 class="var-title">Índice de contenidos seleccionados</h2>'),t.append(i);for(let[e,a]of l.entries()){let l=htmlToElement(`<a class="index-link" role="link"><span>${n.variables[e].nombre}</span></a>`);if(l.onclick=()=>t.querySelector(`#var-${e}`).scrollIntoView(),t.append(l),r>=2)for(let[l,i]of a.entries()){let a=htmlToElement(`<a class="index-link indent" role="link"><span>${o[l]}</span></a>`);if(a.onclick=()=>t.querySelector(`#var-${e}-est-${l}`).scrollIntoView(),t.append(a),r>=3)for(let a of i.keys()){let i=htmlToElement(`<a class="index-link indent-2" role="link"><span>${n.segmentaciones[a]}</span></a>`);i.onclick=()=>t.querySelector(`#var-${e}-est-${l}-seg-${a}`).scrollIntoView(),t.append(i)}}}}function s(e){i.scrollIntoView(),e.preventDefault()}function u(){let e=htmlToElement('<a class="index-back"><i class="fa-solid fa-arrow-turn-up"></i></a>');return e.onclick=s,e}for(let[e,i]of l.entries()){let l=htmlToElement(`<h2 id="var-${e}" class="var-title">Variable seleccionada: ${n.variables[e].nombre}</h2>`);r>=1&&l.append(u()),t.append(l);for(let[l,s]of i.entries()){let i=htmlToElement(`<label id="var-${e}-est-${l}" for="${e}-${l}" class="est-title"><h2>Estimador seleccionado: ${o[l]} <span><i class="fa-solid fa-circle-info"></i></span></h2></label>`);r>=2&&i.append(u()),t.append(i,htmlToElement(`<input id="${e}-${l}" type="checkbox">`),htmlToElement(`<p>${n.descripciones[l]}</p>`));for(let[i,o]of s.entries()){let s=htmlToElement(`<h2 id="var-${e}-est-${l}-seg-${i}" class="est-title">Segmentación seleccionada: ${n.segmentaciones[i]}</h2>`);r>=3&&s.append(u()),t.append(s);for(let e of o){let n=htmlToElement('<div class="chart-container"><div></div></div>');loadChart(n.querySelector("div"),e,a.m),t.append(n)}}}}return t}function m(e,t,n=!1){return n=n?" checked":"",htmlToElement(`<label><input ${t?`name="${t}"`:""} type="checkbox"${n}><span>${e}</span></label>`)}function p(e,t){let n=e.querySelector("input"),a=t.map((e=>e.querySelector("input")));function l(){a.every((e=>e.checked))?n.checked=!0:a.some((e=>!e.checked))&&(n.checked=!1)}n.addEventListener("change",(()=>{for(let e of a)e.checked=n.checked}));for(let e of a)e.addEventListener("change",l);l()}function f(e){return[...new FormData(e).keys()]}function v(e,t,n,a){var l;if(l=e.trim(),""==(e=l.normalize("NFKD").replace(/\p{Diacritic}/gu,"").toLowerCase()))return t.querySelectorAll("input").forEach((e=>{e.checked=!1}));e=e.split(/\s+/);for(let a of t.children){let t=Array.from(a.querySelectorAll("input")),l=t.shift();l.checked=!1;let i=t.shift();i.checked=!0;for(let a of t){let t=n.variables[a.name].texto;e.every((e=>t.includes(e)))?(a.checked=!0,l.checked=!0):(a.checked=!1,i.checked=!1)}}a()}async function b(){let e=htmlToElement(`<main class="selection-page">${htmlData.main}</main>`),t=0,n=await dataPromise,a=new Set(n.activados),l=e.querySelector("#var-selection");for(let[e,a]of Object.entries(n.bloques)){let i=htmlToElement(`<div>\n\t\t\t<input id="block${++t}-checkbox" type="checkbox">\n\t\t\t<label for="block${t}-checkbox"><span>${e}</span><span><i class="fa-solid fa-play"></i></span></label>\n\t\t</div>`),o=m("Todas"),r=a.map((e=>m(n.variables[e].nombre,e)));p(o,r),i.append(o,...r),l.append(i)}let i=e.querySelector("#est-selection"),o=m("Todas las tablas"),r=Object.entries(n.estimadores).map((e=>m(e[1],e[0],a.has(e[0]))));p(o,r),i.append(o,...r);let s=e.querySelector("#seg-selection"),c=m("Todas"),d=Object.entries(n.segmentaciones).map((e=>m(e[1],e[0],a.has(e[0]))));p(c,d),s.append(c,...d);let h,u=e.querySelector("#m-selection"),b=m("Todas"),w=Object.entries(n.ediciones).map((e=>m(e[1],e[0],a.has(e[0]))));p(b,w),u.append(b,...w);let y=e.querySelector(".main-button");function k(){h={var:f(l),est:f(i),seg:f(s),m:f(u)},y.disabled=!Object.values(h).every((e=>e.length))}for(let t of e.querySelectorAll("input:not([id])"))t.addEventListener("change",k);y.addEventListener("click",(function(){y.disabled=!0,function(e){let t=new URLSearchParams(Object.entries(e).map((e=>[e[0],e[1].join(" ")])));location.hash="?"+t.toString()}(h)})),function(e,t){let n=e.querySelectorAll(".distr-link > span:last-of-type"),a=[t.descripciones.distribution];for(let e=0;e<n.length;e++)n[e].onclick=function(t){t.preventDefault(),alert(a[e])}}(e,n);let g=e.querySelector(".selection-search input");return g.addEventListener("input",(()=>v(g.value,l,n,k))),g.value&&v(g.value,l,n,k),e}window.loadChart=async function(e,o,r){let s=await async function(e,t){let[n,i]=e.split(";");n=`${a()}data/${n}.json`,i=i?i.split(","):[];let o=t?(await l).filter((e=>!t.includes(e))):[];if(!i.some((e=>o.some((t=>e.includes(t))))))return n;let r=await request(n).then((e=>e.text())),s=o.map((e=>`indexof(datum.M, '${e}') == -1`)).join(" && ");return JSON.parse(r.replace("indexof(datum.M, '2') != -1",s))}(o,r);await t;let c=(await vegaEmbed(e,s,{renderer:"canvas",downloadFileName:i(o)})).finalize;r&&function(e,t){let n=`${a()}data/${t.split(";")[0]}.xlsx`,l=htmlToElement(`<a href="${n}" target="_blank" rel="noopener" download>Download table</a>`);e.querySelector(".vega-actions").prepend(l)}(e,o),setTimeout((()=>n.push([e,c])),0)},setInterval((function(){n=n.filter(o)}),1e3),window.share=function(){navigator.share?navigator.share({url:location.href}):navigator.clipboard?navigator.clipboard.writeText(location.href).then((()=>alert("Enlace copiado al portapapeles"))).catch(r):r()};let w=0;async function y(){scrollTo(0,0);const e=w=(w+1)%Number.MAX_SAFE_INTEGER;let t,n,a=location.hash;a.length>1&&"?"==a[1]?[t,n]=[s(),u()]:[t,n]=[htmlToElement(`<header class="main-header-container main-selection-header">\n\t\t${htmlData.header}\n\t</header>`),b()],[t,n]=await Promise.all([t,n]),e==w&&(document.querySelector("header").replaceWith(t),document.querySelector("main").replaceWith(n))}window.onpopstate=y,y();
